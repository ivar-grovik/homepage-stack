
services:

  homepage:

    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    ports:
      - 3001:3000
    volumes:
      - /home/pi/dockers/homepage:/app/config # Make sure your local config directory exists
      - /var/run/docker.sock:/var/run/docker.sock # (optional) For docker integrations
    environment:
      HOMEPAGE_ALLOWED_HOSTS: gethomepage.dev,192.168.68.50:3001,100.109.108.52:3001,127.0.0.1:3001 # required, may need port. See gethomepage.dev/installation/#homepage_allowed_hosts
    restart: unless-stopped
    depends_on:
      - line2-proxy
      - cmd-executor
      - barrier-control

  line2-proxy:
    build: ./line2-proxy
    container_name: line2-proxy
    ports:
      - 3000:3000
    restart: unless-stopped

  cmd-executor:
    build: ./cmd-executor
    container_name: cmd-executor
    volumes:
      - /proc:/host/proc:ro  # For system information
      - /sys:/host/sys:ro    # For system information
      - /var/run/docker.sock:/var/run/docker.sock:ro  # For Docker status
      - /opt/homepage-scripts:/opt/homepage-scripts:ro  # ExpressVPN scripts
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    network_mode: host  # Required to run host commands effectively
    privileged: true  # Required for ExpressVPN control

  barrier-control:
    build: ./barrier-control
    container_name: barrier-control
    ports:
      - 3004:3004
    volumes:
      - /proc:/host/proc:ro  # For process information
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    network_mode: host  # Required to see and control host processes
    pid: host  # Required to see host processes
    privileged: true  # Required to kill processes
